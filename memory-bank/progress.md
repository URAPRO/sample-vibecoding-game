# 進捗記録

## フェーズ1: 基本環境のセットアップと表示確認

- [x] 1-1. HTML ファイル作成
  - index.htmlを作成し、基本的なHTML構造を記述
  - canvasタグを配置
  
- [x] 1-2. CSS ファイル作成と適用
  - style.cssを作成し、基本的なスタイル（bodyのマージンとパディングのリセット、canvasの表示設定）を適用
  
- [x] 1-3. three.js ライブラリ読み込み
  - CDNからthree.jsを読み込み
  
- [x] 1-4. JavaScript ファイル作成と読み込み
  - main.jsを作成し、console.logで読み込み確認
  
- [x] 1-5. three.js シーン、カメラ、レンダラー初期化
  - THREE.Scene, THREE.PerspectiveCamera, THREE.WebGLRendererをインスタンス化
  - カメラの位置と向きを設定
  - レンダラーのサイズをウィンドウサイズに設定
  
- [x] 1-6. 基本的なライトの追加
  - THREE.AmbientLightとTHREE.DirectionalLightを作成し、シーンに追加
  
- [x] 1-7. レンダリングループ作成
  - animate関数を作成し、requestAnimationFrameとrenderer.renderを呼び出すよう設定
  
- [x] 1-8. ウィンドウリサイズ対応
  - window.addEventListenerを使用してリサイズ時の処理を追加

## テスト結果（フェーズ1）
- ブラウザでページを開くと、背景色が設定され、エラーなく表示されることを確認
- ウィンドウサイズを変更しても表示が崩れないことを確認

## フェーズ2: コア要素の実装と確認

- [x] 2-1. 地面 (Plane) の作成と表示
  - THREE.PlaneGeometryとTHREE.MeshStandardMaterialを使用して地面を作成
  - 水平になるように回転させ、プレイヤーの前方に配置
  
- [x] 2-2. プレイヤー (Cube) の作成と表示
  - THREE.BoxGeometryとTHREE.MeshStandardMaterialを使用してプレイヤーを作成
  - 地面の上に配置するよう設定
  
- [x] 2-3. レーン定義とプレイヤー初期位置設定
  - 4つのレーン（X座標）を定義
  - プレイヤーの初期位置を左から2番目のレーンに設定
  
- [x] 2-4. キーボード入力による左右レーン移動
  - 左右矢印キーのイベントリスナーを設定
  - レーン範囲内での移動制限を実装

## テスト結果（フェーズ2）
- 地面とプレイヤーが正しく表示されることを確認
- 左右矢印キーでプレイヤーが4つのレーン間を正しく移動することを確認
- レーン範囲外への移動が制限されていることを確認

## フェーズ3: ゲームメカニクスの実装と確認

- [x] 3-1. プレイヤーの自動前進 (Z軸移動)
  - gameSpeedを定義し、毎フレームプレイヤーの位置を更新する処理を追加
  
- [x] 3-2. カメラの追従
  - プレイヤーと同じ速度でカメラも前進するよう処理を追加
  
- [x] 3-3. 障害物生成関数の作成
  - createObstacle関数を作成し、指定されたレーンとZ座標に障害物を生成する機能を実装
  
- [x] 3-4. 障害物管理配列の準備
  - obstacles配列を作成し、生成された障害物を管理
  
- [x] 3-5. 一定距離ごとの障害物生成ロジック
  - プレイヤーが一定距離進むごとにランダムなレーンに障害物を生成する処理を追加
  
- [x] 3-6. 画面外（後方）の障害物削除ロジック
  - カメラより後方に移動した障害物をシーンから削除し、配列からも削除する処理を追加
  
- [x] 3-7. 衝突判定ロジック (Box3)
  - THREE.Box3を使用して、プレイヤーと障害物の衝突をチェックする関数を実装

## テスト結果（フェーズ3）
- プレイヤーが自動的に前進し、カメラが追従することを確認
- 前方にランダムなレーンで障害物が生成され続けることを確認
- 画面外に出た障害物が適切に削除されることを確認
- プレイヤーが障害物に衝突するとコンソールにメッセージが表示されることを確認

## バグ修正
- 地面が徐々に画面外に出てしまう問題を修正
  - 地面の位置をカメラの位置に連動させることで、常に画面内に表示されるよう修正

## フェーズ4: ゲームフローとUIの実装・確認

- [x] 4-1. ゲーム状態変数の導入
  - gameState変数を導入し、'initial'、'playing'、'gameOver'の3状態を管理
  
- [x] 4-2. ゲーム状態に応じた処理分岐
  - gameStateに応じて、プレイヤーの移動やゲームの進行を制御
  
- [x] 4-3. UI要素の準備 (HTML)
  - スコア表示用の要素とゲームメッセージ表示用の要素を追加
  - CSSでUI要素の位置とスタイルを設定
  
- [x] 4-4. ゲーム開始処理 (Space キー)
  - スペースキーを押すとゲームを開始するように実装
  
- [x] 4-5. スコア計算ロジック
  - ゲームプレイ中に徐々にスコアが加算されるよう実装
  
- [x] 4-6. スコア表示更新
  - 定期的にスコア表示を更新するよう実装
  
- [x] 4-7. ゲームオーバー処理
  - 障害物と衝突した際にゲームオーバー状態に移行し、メッセージとスコアを表示
  
- [x] 4-8. リスタート処理 (R キー)
  - ゲームオーバー状態でRキーを押すとゲームがリスタートするよう実装

## テスト結果（フェーズ4）
- 初期状態でスペースキーを押すとゲームが開始することを確認
- プレイ中にスコアが順調に増加し、表示が更新されることを確認
- 障害物に衝突するとゲームオーバーとなり、適切なメッセージが表示されることを確認
- ゲームオーバー後にRキーを押すとゲームがリスタートすることを確認

## Ver 1.1: スピードアップアイテム機能の追加

- [x] 1-1. 速度変数の導入と適用
  - プレイヤー/カメラの前進速度を変数化
  - `baseSpeed`と`currentGameSpeed`を導入し、ゲーム内での速度管理を実装

- [x] 1-2. アイテム用メッシュ生成関数の作成
  - `createItemMesh()`関数を実装し、黄色い球体のアイテムを生成できるようにした
  - 障害物と明確に区別できる形状と色を設定

- [x] 1-3. アイテム管理用配列の準備
  - `items`配列を作成し、生成されたアイテムを管理できるようにした

- [x] 2-1. オブジェクト生成ロジックの変更
  - 1/3の確率でアイテム、2/3の確率で障害物が生成されるよう実装
  - 障害物生成ロジックを拡張し、アイテムと障害物の両方に対応するよう修正

- [x] 2-2. アイテム削除ロジックの追加
  - 画面外に出たアイテムを削除する処理を実装
  - 障害物削除と同様のロジックでメモリリークを防止

- [x] 3-1. アイテム用衝突判定の追加
  - `checkCollision()`関数に、アイテムとの衝突判定を追加
  - アイテムとの衝突を検知したら`collectItem()`を呼び出すよう実装

- [x] 3-2. アイテム獲得処理の実装
  - `collectItem()`関数を作成し、アイテム衝突時の処理を実装
  - シーンと配列からアイテムを削除し、スピードアップ効果を適用

- [x] 3-3. スピードアップ効果の実装
  - スピードアップの倍率（1.5倍）と効果時間（5秒）を設定
  - タイマーを使って、効果時間後に自動的に速度を元に戻す機能を実装
  - 効果中に再度アイテムを獲得した場合、タイマーをリセットする処理を追加

- [x] 4-1. リスタート処理の修正
  - リスタート時に`items`配列のクリアとスピードアップ効果のリセットを追加
  - 残っているタイマーをキャンセルし、速度を基本値に戻す処理を実装

- [x] 4-2. パラメータ調整
  - スピードアップの倍率を1.5倍に設定
  - 効果時間を5000ミリ秒（5秒）に設定
  - アイテム出現確率を1/3に設定

## テスト結果（Ver 1.1）
- 黄色い球体のアイテムが適切な頻度（約1/3）で出現することを確認
- プレイヤーがアイテムに接触すると、アイテムが消え、プレイヤーとカメラの移動速度が明らかに速くなることを確認
- スピードアップ効果が約5秒後に自動的に解除され、通常速度に戻ることを確認
- スピードアップ中に再度アイテムを獲得すると、効果時間がリセットされることを確認
- ゲームオーバー後のリスタート時に、速度が正常な基本速度に戻り、アイテムが残らないことを確認

## Ver 1.2: ビジュアルエフェクトの追加

- [x] 1-1. パーティクル用ジオメトリとマテリアルの準備
  - THREE.BufferGeometryとTHREE.PointsMaterialを使用してパーティクルシステムを作成
  - パーティクルの色、サイズ、透過設定を行い、シーンに追加

- [x] 1-2. パーティクル管理配列と生成ロジック
  - trailParticles配列を作成してパーティクル情報を管理
  - emitParticle関数を実装し、プレイヤーの後方にパーティクルを生成

- [x] 1-3. パーティクル更新と描画
  - updateParticles関数で位置更新、寿命管理、透明度変更を実装
  - デルタタイムに基づく更新でフレームレート非依存の動きを実現

- [x] 2-1. マーカー用メッシュ生成関数の作成
  - createLaneMarker関数を実装し、レーン変更時に表示する円形マーカーを作成
  - マーカーの色と透明度を設定

- [x] 2-2. レーン変更時のマーカー表示ロジック
  - キーボード入力ハンドラ内でレーン変更時にマーカーを生成
  - マーカーの位置をプレイヤーの足元に設定

- [x] 2-3. マーカーのフェードアウトと削除
  - updateMarkers関数で経過時間に応じた透明度の更新と削除を実装

- [x] 3-1. アイテム獲得処理の変更
  - collectItem関数を修正し、即座に削除せずエフェクト表示用の処理を追加
  - itemEffects配列に拡大・フェードアウト用の情報を格納

- [x] 3-2. 拡大・フェードアウトアニメーション
  - updateItemEffects関数で時間経過に応じたスケールと透明度の更新を実装
  - アニメーション完了後にシーンからアイテムを削除

- [x] 4-1. 画面シェイク関数の実装
  - shakeCamera関数を実装し、指定された強度と時間でカメラを揺らす効果を追加
  - 時間経過に応じて揺れの強さが徐々に減少する仕組みを実装

- [x] 4-2. 破片パーティクル生成関数の実装
  - createDebris関数を実装し、衝突位置から複数の破片メッシュを生成
  - 各破片にランダムな速度、回転、寿命を設定

- [x] 4-3. 破片の更新と削除
  - updateDebris関数で破片の位置、回転、透明度の更新と寿命管理を実装
  - 重力効果を加えて、より自然な動きを実現

- [x] 4-4. 障害物衝突処理への組み込み
  - 衝突判定時にshakeCameraとcreateDebrisを呼び出すよう実装
  - 衝突した障害物を直ちに削除して破片エフェクトを表示

- [x] 5-1. エフェクトのパラメータ調整
  - 各エフェクトの見た目（色、サイズ、速度、寿命など）を調整
  - エフェクト間のバランスを最適化

- [x] 5-2. リスタート処理の修正
  - restartGame関数にエフェクト関連の配列とオブジェクトをクリアする処理を追加

## テスト結果（Ver 1.2）
- プレイヤーの後ろからトレイルエフェクトのパーティクルが放出され、徐々に消えていくことを確認
- レーン変更時に地面上にマーカーが表示され、フェードアウトすることを確認
- アイテム獲得時に拡大しながら透明になるアニメーションが表示されることを確認
- 障害物衝突時に画面がシェイクし、障害物が複数の破片に分かれて飛び散ることを確認
- ゲームリスタート時に全エフェクトが正しくリセットされることを確認
